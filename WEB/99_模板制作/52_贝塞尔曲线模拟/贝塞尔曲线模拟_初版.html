<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>贝塞尔曲线模拟_初版</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        #control1,#control2{
            width: 20px;
            height:20px;
            border-radius: 10px;
            border: 1px solid black;
            position: absolute;
            cursor: pointer;
        }
        #control1{
            background-color: rgb(249,0,119);
            left:0;
            top: 140px;
        }
        #control2{
            background-color: rgb(25,154,174);
            left:500px;
            top: 640px;
        }
        #all{
            width: 520px;
            height: 800px;
            position: relative;
        }
    </style>
</head>
<body>
<div id="all">
    <canvas id="canvas" width="520" height="800">
        低版本浏览器不支持

    </canvas>
    <div id="control1"></div>
    <div id="control2"></div>
</div>


<script type="text/javascript">
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    var control1 = document.getElementById("control1");
    var control2 = document.getElementById("control2");
    var all = document.getElementById("all");


    ctx.translate(10,0);
    function line(width,length,color){
        this.width = width;
        this.length = length;
        this.color = color;
    };
    
    line.prototype.drawLine = function (startPos,endPos) {
        ctx.beginPath();
        ctx.strokeStyle = this.color;
        ctx.lineWidth = this.width;
        ctx.moveTo(startPos.x,startPos.y);
        ctx.lineTo(endPos.x1,endPos.y1)
        ctx.stroke();
    }

    line.prototype.drawBall = function (cir,fillStyle) {
        ctx.beginPath();
        ctx.strokeStyle = this.color;
        ctx.lineWidth = this.width;
        ctx.arc(cir.x,cir.y,this.length,0,Math.PI*2,false);
        ctx.fillStyle = fillStyle;
        ctx.fill();
        ctx.stroke();
    }

    line.prototype.drawBezier = function (endPos1,endPos2) {
        ctx.beginPath();
        ctx.strokeStyle = this.color;
        ctx.lineWidth = this.width;
        ctx.moveTo(0,650);
        console.log("a="+endPos1.x,"b="+endPos1.y,"c="+endPos2.x1,"d="+endPos2.y1);
        ctx.bezierCurveTo(endPos1.x,endPos1.y,endPos2.x1,endPos2.y1,500,150);
        ctx.stroke();
    }

    var yuanLine1 = new line(1,500,"black"),
        yuanLine2 = new line(1,500,"black"),
        yuanLine3 = new line(10,Math.sqrt(Math.pow(500)+Math.pow(500)),"rgba(0,0,0,.1)");

    var yuanball1 = new  line(1,10,"black"),yuanBall2 = new line(1,10,"black");
    var ball1Line = new line(5,10,"gray"), ball2Line = new line(5,10,"gray");
    var bezierLine = new line(10,10,"black");

    yuanLine1.drawLine({x:0,y: 650},{x1:0,y1: 150});
    yuanLine2.drawLine({x:0, y: 650},{x1: 500, y1: 650});
    yuanLine3.drawLine({x:0, y: 650},{x1: 500, y1: 150});
    yuanball1.drawBall({x:0, y:650},"white");
    yuanBall2.drawBall({x:500, y:150},"white");

    bezierLine.drawBezier({
        x: control1.offsetLeft +10,
        y: control1.offsetTop+10
    },{
        x1: control2.offsetLeft +10,
        y1: control2.offsetTop+10
    });

    control1.onmousedown = function (ev) {
        var e = ev || window.event;

        var X = e.clientX;
        var Y = e.clientY;

        var ctr1X = control1.offsetLeft;
        var ctr1Y = control1.offsetTop;
        document.onmousemove = function (ev) {
            var e = ev || window.event;

            var nowX = e.clientX;
            var nowY = e.clientY;

            var endPosX = ctr1X + nowX - X;
            var endPosY = ctr1Y + nowY - Y;
            
            if (endPosX < 0) {
            	endPosX = 0;
            } else if(endPosX > all.clientWidth - control1.offsetWidth){
            	endPosX = all.clientWidth - control1.offsetWidth;
            }
            control1.style.left = endPosX + "px";
            control1.style.top = endPosY + "px";


            setTimeout(function () {
                ctx.clearRect(-10,0,canvas.width+10,canvas.height);
                yuanLine1.drawLine({x:0, y: 650},{x1:0, y1: 150});
                yuanLine2.drawLine({x:0, y: 650},{x1: 500, y1: 650});
                yuanLine3.drawLine({x:0, y: 650},{x1: 500, y1: 150});
                yuanball1.drawBall({x:0, y:650},"white");
                yuanBall2.drawBall({x:500, y:150},"white");

                ball1Line.drawLine({x:0, y: 650},{x1:control1.offsetLeft,y1:control1.offsetTop+10});
                ball2Line.drawLine({x:500, y: 150},{x1:control2.offsetLeft,y1:control2.offsetTop+10});
                bezierLine.drawBezier({
                    x: control1.offsetLeft +10,
                    y: control1.offsetTop+10
                },{
                    x1: control2.offsetLeft +10,
                    y1: control2.offsetTop+10
                });
            });

        }
        control1.onmouseup = function () {
            document.onmousemove = function () {
                return false;
            }
        }
    }

    control2.onmousedown = function (ev) {
        var e = ev || window.event;

        var X = e.clientX;
        var Y = e.clientY;

        var ctr1X = control2.offsetLeft;
        var ctr1Y = control2.offsetTop;
        document.onmousemove = function (ev) {
            var e = ev || window.event;

            var nowX = e.clientX;
            var nowY = e.clientY;

           var endPosX = ctr1X + nowX - X;
            var endPosY = ctr1Y + nowY - Y;
            
            if (endPosX < 0) {
            	endPosX = 0;
            } else if(endPosX > all.clientWidth - control2.offsetWidth){
            	endPosX = all.clientWidth - control2.offsetWidth;
            }
            control2.style.left = endPosX + "px";
            control2.style.top = endPosY + "px";

            setTimeout(function () {
                ctx.clearRect(-10,0,canvas.width+10,canvas.height);
                yuanLine1.drawLine({x:0, y: 650},{x1:0, y1: 150});
                yuanLine2.drawLine({x:0, y: 650},{x1: 500, y1: 650});
                yuanLine3.drawLine({x:0, y: 650},{x1: 500, y1: 150});
                yuanball1.drawBall({x:0, y:650},"white");
                yuanBall2.drawBall({x:500, y:150},"white");

                ball1Line.drawLine({x:0, y: 650},{x1:control1.offsetLeft,y1:control1.offsetTop+10});
                ball2Line.drawLine({x:500, y: 150},{x1:control2.offsetLeft,y1:control2.offsetTop+10});
                bezierLine.drawBezier({
                    x: control1.offsetLeft +10,
                    y: control1.offsetTop+10
                },{
                    x1: control2.offsetLeft +10,
                    y1: control2.offsetTop+10
                });
            });

        }
        control2.onmouseup = function () {
            document.onmousemove = function () {
                return false;
            }
        }
    }



</script>
</body>
</html>